# LOONFLOW V0.1使用文档
a workflow engine base django
基于django的工作流引擎系统,通过http接口调用。 可以作为企业内部统一的工作流引擎，提供诸如权限申请、资源申请、发布申请、请假、报销、it服务等所有工作流场景的服务。如果有一定的开发能力建议只使用后端引擎功能，前端根据场景定制开发可分散于各个内部后台管理系统(如人事、运维、监控、cmdb等等)。

## 前言
本人2011年开始接触工作流，2013年开始开发工作流第一版本，至今经历了多个版本。目前着手开发一个开源版本，致力于提供企业统一工作流引擎方案

欢迎加入qq群一起交流工作流相关技术: 558788490

## 运行开发环境
- 创建数据库并修改settings/dev.py中相应配置
- 创建python虚拟环境: python3.5
- 安装依赖包: pip install -r backend/requirements/dev.txt
- 初始化数据库: 
```
python manage.py makemigrations
python manage.py migrate
```
- 初始化数据: python manage.py loaddata notice_type.json
- 创建初始账户: python manage.py createsuperuser
- 启动开发环境: python manage.py runserver

## 生产环境部署
- 创建数据库并修改settings/dev.py中相应配置
- 创建python虚拟环境:python3.5
- 按照依赖包: pip install -r backend/requirements/pro.txt
- 初始化数据库:
```
python manage.py makemigrations
python manage.py migrate
```
- 初始化数据: python manage.py loaddata notice_type.json
- 创建初始账户: python manage.py createsuperuser
- python manage.py collectstatic
- 建议使用nginx+uwsgi部署


## 术语定义 
工单：具体的待处理事项，用户新建的是工单，工单按照工作流的设计来实现不同状态不同处理人之间的流转

工作流：即工作流的设计，定义了工单的审批链、各状态的处理人、各状态可以执行的操作（提交、保存，处理完成，退回，关闭等等）、每个状态下显示哪些字段、哪些字段可以在哪些编辑

工作流处理过程可以理解为工单状态的变化，如一个工作流处理过程中可以有：发起人新建中、发起人编辑中、部门经理审核中、技术人员处理中、发起人验证中、结束等状态，每个状态对应相应的处理人（如部门经理审核中这个状态下只有部门经理才可以处理该工单）。如用户在新建工单的时候处于“发起人新建中”，（用户）提交后工单处于“部门经理审核中”， 部门经理（即“部门经理审核中”状态的处理人）审批通过后，工单的状态变更为“技术人员处理中”。

## 基本架构
LOONFLOW 分为两部分:
- 使用django自带的admin来管理工作流的配置信息: http://127.0.0.1:8000/admin 
- 提供http api共各个系统(如果oa、cmdb、运维系统、客服系统)调用以完成各自系统定制化的工单需求

## 工作流配置（V0.3版本将弃用django自带的admin后台）
1. 登录后台
- 使用部署过程中创建的用户名密码 http://127.0.0.1/admin (或生产部署后的地址http://www.xxx.com/admin) 
2. 管理后台基本功能
loonflow后台管理系统分为三个部分(为了早点上线开源，所有后台管理系统使用了django admin。将在v0.3版本重写管理界面):
- 工作流:工作流的配置,包括工作流记录、工作流的流转配置、工作流状态的配置、工作流自定义字段的配置、自定义通知脚本(用于工单流转过程中的消息通知相关人员)
- 工单:具体的工单记录，此部分平时是不需要修改的，只有在需要人工干预工单流转的时候可以修改（当然你也可以直接修改数据库）
- 账户:用户信息,包括用户、用户角色、角色、部门以及调用token（用于api调用的授权）。在开始具体的工作流配置时，需要将你所在单位的用户、角色、用户角色、部门信息同步到loonflow中(建议写个脚本定时同步)
![admin_homapage](/assets/admin_homapage.png)
3.工作流配置
- 同步账户中用户、角色、用户角色(用户具有的角色)、部门信息
- 新建工作流
- 新建工作流的自定义字段(如果需要的话):工单默认只提供id、流水号、标题、当前状态、当前处理人类型、当前处理人、创建时间、修改时间等字段。不同类型的工单可能需要不同的自定义字段，可以在此处给相应的工作流配置自定义字段
- 设置工作流的状态: 工作流对应多个字段（发起人新建中、领导审批中、技术人员处理中、已结束等等）
- 设置工作流流转: 工作流流转控制工单状态的变化，流转的名称即工单处理中的按钮的名称，用户点击工单后，系统通过此表中的配置获取到下个状态信息，以更新工单的状态以及做相应的其他操作(执行脚本、通知相关人员等等)

## API调用


